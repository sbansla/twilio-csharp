name: Test and Deploy
on:
  push:
    branches: [ '*' ]
    tags: [ '*' ]
  pull_request:
    branches: [ main ]
  schedule:
    # Run automatically at 8AM PST Monday-Friday
    - cron: '0 15 * * 1-5'
  workflow_dispatch:

jobs:
  test:
    name: Test
    runs-on: ubuntu-latest
    timeout-minutes: 20
    steps:
      - name: Checkout twilio-csharp
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Setup .NET Core SDK
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: 7.0.103

      - name: Remove faulty SDK version
        run: sudo rm -rf /usr/share/dotnet/sdk/7.0.4*

      - name: Build & Test
        run: make test
          
  import-certificate:
    runs-on: windows-latest
    steps:
     - uses: actions/checkout@v2
     - run: make install
         
  deploy:
    name: Deploy
    needs: [ test, import-certificate ]
    runs-on: ubuntu-latest
    steps:
      - name: Checkout twilio-csharp
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
          
      - name: Setup .NET Core SDK
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: 6.0.x

      - name: Remove faulty SDK version
        run: sudo rm -rf /usr/share/dotnet/sdk/7.0.4*
        
      - name: List files in a directory
        run: |
          # Replace 'your/directory/path' with the actual directory path you want to list
          directory_path="src/Twilio/"
          
          # List files in the specified directory
          ls "$directory_path"

